<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html>
	<head>
		<meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1" />
		<title>Test</title>
		
		<link rel="stylesheet" href="../qunit/main.css" media="all" charset="UTF-8" />
		<link rel="stylesheet" href="../qunit/qunit.css" media="all" charset="UTF-8" />
		
		<style type="text/css">
			table {
				border-spacing: 2px;
			}
			table td {
				border: 1px dotted #000;
				padding: 5px;
			}
			
			.syoFilter {
				border: 1px solid #000;
			}
			
			.syoInput {
				background-color: #CCC;
			}
			
			thead tr {
				background-color: #EEE;
			}
		</style>
		
		<script type="text/javascript" src="../qunit/qunit.js"></script>
		<script type="text/javascript" src="../lib/jquery-1.7.1.js"></script>
		<script type="text/javascript" src="../src/utils.js"></script>
		<script type="text/javascript" src="../src/syoTableFilter.js"></script>
		<script type="text/javascript" language="Javascript">
			$(function() {
				
				$("#t1").syoTableFilter({
					inputClasses: 'syoInput syoFilter',
					trClasses: 'syoTR syoFilter',
					delay: 100,
					columns: null
				});
				$("#t2").syoTableFilter({
					delay: 100
				});
				$("#t3").syoTableFilter({
					ignoreCase: false,
					columns: [0, 1, 2, 3, 4],
					delay: 100
				});
				$("#t4").syoTableFilter({
					delay: 100
				});
				$("#t5").syoTableFilter({
					columns: [1, 3],
					delay: 100
				});
				
				if(true) {
					var timeoutSpeed = 200;
					
					//==============================================================================================
					//	T1
					//==============================================================================================
					test("Os inputs devem possuir as classes especificadas em 'inputClasses'", function() {
						$("#t1").find('thead input').each(function() {
							same($(this).attr('class').split(' ')[0], 'syoInput', "Deve conter a classe 'syoInput'");
							same($(this).attr('class').split(' ')[1], 'syoFilter', "Deve conter a classe 'syoFilter'");
						});
					});
					test("A TR deve possuir as classes especificadas em 'trClass'", function() {
						var $inputs = $("#t1").find('thead tr.syoTR.syoFilter input');
						same($inputs.length,  4, "Devem ser encontrados 4 inputs na thead tr.syoTR.syoFilter");
					});
					test("Depois de no máximo 2 segundos deve restar apenas uma TR visível", function() {
						var $inputs = $("#t1").find('thead input');
						$inputs.slice(0, 1).val('Mar');
						$inputs.slice(2, 3).val('timba');
						$inputs.slice(3, 4).val('tanga').trigger('keydown');
						stop();
						
						setTimeout(function() {
							var $trs = $("#t1").find('tbody tr:visible');
							start();
							same($trs.length, 1, "Uma TR deve ficar visível no tbody");
							same($trs.slice(0, 1).find('td:first').text().trim(), 'Cleosgrildo Martins Manufunfu', "A primeira coluna da primeira linha deve possuir o nome 'Cleosgrildo Martins Manufunfu'");
						}, timeoutSpeed);
					});
					test("Depois de no máximo 2 segundos deve restar apenas uma TR visível novamente", function() {
						var $inputs = $("#t1").find('thead input');
						$inputs.slice(0, 1).val('Mar');
						$inputs.slice(2, 3).val('timba');
						$inputs.slice(3, 4).val('tanga').trigger('keydown');
						stop();
						
						setTimeout(function() {
							var $trs = $("#t1").find('tbody tr:visible');
							start();
							same($trs.length, 1, "Uma TR deve ficar visível no tbody");
							same($trs.slice(0, 1).find('td:first').text().trim(), 'Cleosgrildo Martins Manufunfu', "A primeira coluna da primeira linha deve possuir o nome 'Cleosgrildo Martins Manufunfu'");
						}, timeoutSpeed);
					});
					test("Depois de no máximo 2 segundos deve exibir todas as TRs se todos os inputs estiverem vazios", function() {
						var $inputs = $("#t1").find('thead input');
						$inputs.each(function() {
							$(this).val('');
						});
						$inputs.slice(0, 1).trigger('keydown');
						stop();
						
						setTimeout(function() {
							var $trs = $("#t1").find('tbody tr:visible');
							start();
							same($trs.length, 3, "Deve existir 3 TRs visíveis");
						}, timeoutSpeed);
					});
					test("O filtro de uma coluna deve ser realizado em cima das linhas visíveis, ou seja, qualquer filtro previamente definido deve ser levado em conta", function() {
						var $inputs = $("#t1").find('thead input');
						$inputs.slice(0, 1).val('Mar');
						$inputs.slice(3, 4).val('Mo').trigger('keydown');
						stop();
						
						setTimeout(function() {
							var $trs = $("#t1").find('tbody tr:visible');
							start();
							same($trs.length, 1, 'Deve sobrar uma linha visível nesta tabela');
							same($trs.find('td:first').text().trim(), 'Fagner Martins Brack', 'O valor da primeira coluna deve ser "Fagner Martins Brack"');
							same($trs.find('td:eq(3)').text().trim(), 'Montenegro', 'O valor da coluna 3 deve ser "Montenegro"');
						}, timeoutSpeed);
					});
					test("O valor do input deve desconsiderar espaços que não estejam entre duas palavras", function() {
						var $inputs = $("#t1").find('thead input').each(function() {
							$(this).val('');
						});
						$inputs.slice(0, 1).val('  ').trigger('keydown');
						stop();
						
						setTimeout(function() {
							var $trs = $("#t1").find('tbody tr:visible');
							start();
							same($trs.length, 3, 'Todas as 3 trs devem estar visíveis');
							$("#t1").find('thead input').slice(0, 1).val(''); //Apaga o valor para não ficar espaços
						}, timeoutSpeed);
					});
					test("Filtro com aspas deve considerar a palavra completa", function() {
						var $inputs = $("#t1").find('thead input').slice(0, 1).val('"Martins"').trigger('keydown');
						stop();
						
						setTimeout(function() {
							var $trs = $("#t1").find('tbody tr:visible');
							start();
							same($trs.length, 2, "Devem restar duas linhas visíveis");
							same($trs.slice(0, 1).find('td:first').text().trim(), "Fagner Martins Brack", "A primeira coluna da primeira linha deve possuir o valor 'Fagner Martins Brack'");
							same($trs.slice(1, 2).find('td:eq(1)').text().trim(), "Estrada de Tijolos Amarelos", "A segunda coluna da segunda linha deve possuir o valor 'Estrada de Tijolos Amarelos '");
						}, timeoutSpeed);
					});
					test("Filtro com aspas deve considerar a palavra completa e também a regra de espaço", function() {
						var $inputs = $("#t1").find('thead input').slice(0, 1).val('Manu "Martins"').trigger('keydown');
						stop();
						
						setTimeout(function() {
							var $trs = $("#t1").find('tbody tr:visible');
							start();
							same($trs.length, 1, "Deve restar 1(uma) linha visível");
							same($trs.slice(0, 1).find('td:first').text().trim(), "Cleosgrildo Martins Manufunfu", "A primeira coluna da primeira linha deve possuir o valor 'Cleosgrildo Martins Manufunfu'");
						}, timeoutSpeed);
					});
					test("Meia palavra não deve ser considerada em um filtro com aspas", function() {
						var $inputs = $("#t1").find('thead input').slice(0, 1).val('"Mar"').trigger('keydown');
						stop();
						
						setTimeout(function() {
							var $trs = $("#t1").find('tfoot tr:visible');
							start();
							same($trs.length, 1, "Deve restar 1(uma) linha visível no tfoot");
							ok($trs.hasClass('syo-filter-info'), "A linha deve ser a de registro não encontrado");
						}, timeoutSpeed);
					});
					test("Duas palavras entre aspas devem ser consideradas apenas como um critério de busca", function() {
						var $inputs = $("#t1").find('thead input').slice(0, 1).val('"Fagner Martins"').trigger('keydown');
						stop();
						
						setTimeout(function() {
							var $trs = $("#t1").find('tbody tr:visible');
							start();
							same($trs.length, 1, "Deve restar 1(uma) linha visível no tbody");
							same($trs.slice(0, 1).find('td:first').text().trim(), "Fagner Martins Brack", "A primeira coluna da primeira linha deve possuir o valor 'Fagner Martins Brack'");
						}, timeoutSpeed);
					});
					
					//==============================================================================================
					//	T2
					//==============================================================================================
					test("Depois de no máximo 2 segundos deve restar apenas uma tr com as informações de registro não encontrado", function() {
						$("#t2").find('thead input').slice(1, 2).val('Casa').trigger('keydown');
						stop();
						
						setTimeout(function() {
							var $trs = $("#t2").find('tfoot tr.syo-filter-info:visible');
							start();
							ok(!!$("#t2").find('tfoot').length, "Se não houver tfoot o programa deve criar");
							ok($("#t2").children('tfoot:last').find('tr:last').hasClass('syo-filter-info'), "O tfoot deve estar abaixo do último tbody");
							same($trs.length, 1, "Deve existir apenas uma TR visível com a classe syo-filter-info nesta tabela");
						}, timeoutSpeed);
					});
					test("Os inputs não devem possuir classe nenhuma", function() {
						$("#t2").find('thead input').each(function() {
							same($(this).attr('class'), '', "O valor deve ser uma string vazia");
						});
					});
					
					//==============================================================================================
					//	T3
					//==============================================================================================
					test("Só existem inputs nos índices de coluna: 0, 1, 2, 3 e 4", function() {
						var $headTDs = $("#t3").find('thead tr:eq(1) td');
						same($headTDs.slice(0, 1).find('input').length, 1, "Deve existir 1 input do tipo text na coluna 0");
						same($headTDs.slice(1, 2).find('input').length, 1, "Deve existir 1 input do tipo text na coluna 1");
						same($headTDs.slice(2, 3).find('input').length, 1, "Deve existir 1 input do tipo text na coluna 2");
						same($headTDs.slice(3, 4).find('input').length, 1, "Deve existir 1 input do tipo text na coluna 3");
						same($headTDs.slice(4, 5).find('input').length, 1, "Deve existir 1 input do tipo text na coluna 4");
						same($headTDs.slice(5, 6).find('input').length, 0, "Deve existir 0 inputs do tipo text na coluna 5");
					});
					test("Só deve existir 1 input de filtro por coluna e ele deve estar apenas na primeira thead", function() {
						var $firstHead = $("#t3 thead:first").find('input');
						var $secondHead = $("#t3 thead:eq(1)").find('input');
						
						ok($firstHead.length > 0, "Devem existir inputs no primeiro thead");
						ok($secondHead.length === 0, "NÃO devem existir inputs no segundo thead");
					});
					test("Os inputs devem ser incluidos depois do último elemento do primeiro thead", function() {
						var $firstHead = $("#t3 thead:first").find('tr:last').find('input');
						
						ok($firstHead.length > 0, "Deve existir inputs no último elemento do primeiro THEAD");
					});
					test("Se já houver tfoot a tr de registro não encontrado deve ser posicionada abaixo da última tr do último tfoot", function() {
						var $inputs = $("#t3 thead:first input");
						
						//não deve filtrar o "to", apenas o "TO"
						$inputs.slice(0, 1).val('TEXTO-QUE-NÃO-EXISTE').trigger('keydown');
						stop();
						
						setTimeout(function() {
							var $tr = $("#t3").find('tfoot:last tr:last');
							start();
							ok($tr.hasClass('syo-filter-info'), "A última TR deve possuir a classe 'syo-filter-info'");
						}, timeoutSpeed);
					});
					test("Um input deve filtrar as TDs de TODOS os tbodies que existirem na tabela e deve diferenciar letras maiúsculas de minúsculas", function() {
						var $inputs = $("#t3 thead:first input");
						
						//não deve filtrar o "to", apenas o "TO"
						$inputs.slice(0, 1).val('TO').trigger('keydown');
						stop();
						
						setTimeout(function() {
							var $tr1 = $("#t3 tbody:first tr:visible");
							var $tr2 = $("#t3 tbody:eq(1) tr:visible");
							
							start();
							same($tr1.length, 1, "Deve existir apenas uma tr no primeiro tbody");
							same($tr2.length, 1, "Deve existir apenas uma tr no segundo tbody");
							same($tr1.find('td:first').text().trim(), "TO - 105.000KM - PASSANTES", "A primeira TD da primeira linha deve possuir o valor 'TO - 105.000KM - PASSANTES'");
							same($tr2.find('td:first').text().trim(), "TO - 5.000KM - PASSANTES", "A primeira TD da segunda linha deve possuir o valor 'TO - 5.000KM - PASSANTES'");
						}, timeoutSpeed);
					});
					test("As tags input, select e textarea que estiverem dentro de linhas ocultas e que foram desabilitadas pelo syoFilterTable, devem ser habilitadas quando estiverem visíveis novamente", function() {
						var $inputs = $("#t3").find('thead input').slice(0, 1).val('').trigger('keydown');
						stop();
						
						setTimeout(function() {
							var $visibleFormFilterElements = $("#t3 tbody tr:visible").find('input, select, textarea').filter(':visible');
							
							start();
							same($visibleFormFilterElements.not(':disabled').filter(':radio').length, 3, "3(três) elementos radio devem ser habilitados pelo syoTableFilter");
							same($visibleFormFilterElements.not(':disabled').filter(':checkbox').length, 1, "1(um) elemento checkbox deve ser habilitado pelo syoTableFilter");
							same($visibleFormFilterElements.filter(':disabled').filter('select').length, 1, "1(um) elemento select deve continuar desabilitado");
							same($visibleFormFilterElements.filter(':disabled').filter('input:text').length, 1, "1(um) elemento input:text deve continuar desabilitado");
						}, timeoutSpeed);
					});
					test("Teste avançado de palavras com aspas e sem aspas junto 1", function() {
						var $inputs = $("#t3").find('thead input').slice(0, 1).val('"12M" MONTANA "GARANTIA ESPECIAL"').trigger('keydown');
						stop();
						
						setTimeout(function() {
							var $trs = $("#t3").find('tbody tr:visible');
							start();
							same($trs.length, 1, "Deve restar 1(uma) linha visível no tbody");
							same($trs.slice(0, 1).find('td:first').text().trim(), "MONTANA 12M GARANTIA ESPECIAL", "A primeira coluna da primeira linha deve possuir o valor 'MONTANA 12M GARANTIA ESPECIAL'");
						}, timeoutSpeed);
					});
					test("Teste avançado de palavras com aspas e sem aspas junto 2", function() {
						var $inputs = $("#t3").find('thead input').slice(0, 1).val('"12" MONTANA "GARANTIA"').trigger('keydown');
						stop();
						
						setTimeout(function() {
							var $trs = $("#t3").find('tbody tr:visible');
							var $tfootTRs = $("#t3").find('tfoot tr:visible');
							start();
							same($trs.length, 0, "Não deve restar nenhuma linha visível no tbody");
							same($tfootTRs.length, 2, "Deve restar 2(uma) linhas visíveis no tfoot");
							ok($tfootTRs.slice(1, 2).hasClass('syo-filter-info'), "Uma das linhas acima deve ser a de registro não encontrado");
						}, timeoutSpeed);
					});
					
					//==============================================================================================
					//	T4
					//==============================================================================================
					test("Linhas ocultas em qualquer parte da tabela devem ser ignoradas pelo plugin na hora de filtrar", function() {
						var $inputs = $("#t4 thead tr input").slice(0, 1).val('Alfredo').trigger('keydown');
						stop();
						
						setTimeout(function() {
							var $inputs = $("#t4 thead tr:visible input").slice(0, 1).val('').trigger('keydown');
							
							setTimeout(function() {
								var $trs = $("#t4 tbody tr:visible");
								start();
								same($trs.length, 3, "Deve sobrar apenas 3 linhas");
								same($trs.slice(0, 1).find('td:first').text().trim(), 'Alfredo Martins da Silva', "A primeira coluna da primeira linha deve conter o nome 'Alfredo Martins da Silva'");
								same($trs.slice(1, 2).find('td:first').text().trim(), 'Manuel Marca dos Santos', "A primeira coluna da segunda linha deve conter o nome 'Manuel Marca dos Santos'");
								same($trs.slice(2, 3).find('td:first').text().trim(), 'Fernando da Silva Martins', "A primeira coluna da terceira linha deve conter o nome 'Fernando da Silva Martins'");
							}, timeoutSpeed);
						}, timeoutSpeed);
					});
					
					//==============================================================================================
					//	T5
					//==============================================================================================
					test("Testa colunas com inputs não adicionados à esquerda", function() {
						var $inputs = $("#t5 thead tr:last").find('td:eq(1) input').val('Jacinto').trigger('keydown');
						stop();
						
						setTimeout(function() {
							var $trs = $("#t5 tbody tr:visible");
							start();
							same($trs.length, 1, 'Deve existir uma TR visível')
							same($trs.slice(0, 1).find('td:first').text().trim(), 'Alfredo Martins da Silva', "A primeira coluna da primeira linha deve possuir o valor 'Alfredo Martins da Silva'")
						}, timeoutSpeed);
					});
				}
			});
		</script>
	</head>
	<body>
		<h1 id="qunit-header">QUnit Test Suite</h1>
		<h2 id="qunit-banner"></h2>
		<div id="qunit-testrunner-toolbar"></div>
		<h2 id="qunit-userAgent"></h2>
		<ol id="qunit-tests"></ol>
		<div id="qunit-fixture">test markup</div>
		
		<hr />
		Table 1:
		<table id="t1">
			<thead>
				<tr>
					<th>Nome</th>
					<th>Rua</th>
					<th>Bairro</th>
					<th>Cidade</th>
				</tr>
			</thead>
			<tbody>
				<tr>
					<td>
						Fagner Martins Brack
					</td>
					<td>
						Rua Capitão Fernando Schneider
					</td>
					<td>
						Timbaúva
					</td>
					<td>
						Montenegro
					</td>
				</tr>
				<tr>
					<td>
						Fulano da Silva Sauro
					</td>
					<td>
						Rua Sem Nome
					</td>
					<td>
						Bairroso
					</td>
					<td>
						Não-Toquei
					</td>
				</tr>
				<tr>
					<td>
						Cleosgrildo Martins Manufunfu
					</td>
					<td>
						Estrada de Tijolos Amarelos
					</td>
					<td>
						Timbarapavioso
					</td>
					<td>
						Tangamandápio
					</td>
				</tr>
			</tbody>
		</table>
		<hr />
		Table 2:
		<table id="t2">
			<thead>
				<tr>
					<th>Nome</th>
					<th>Rua</th>
					<th>Bairro</th>
					<th>Cidade</th>
				</tr>
			</thead>
			<tbody>
				<tr>
					<td>
						Fagner Martins Brack
					</td>
					<td>
						Rua Capitão Fernando Schneider
					</td>
					<td>
						Timbaúva
					</td>
					<td>
						Montenegro
					</td>
				</tr>
			</tbody>
		</table>
		<hr />
		Table 3:
		<table id="t3">
			<thead>
				<tr>
					<th>Revisões da Empresa X</th>
					<th>Coluna do input</th>
					<th>KM</th>
					<th>Tempo</th>
					<th>Critério</th>
					<th>Links</th>
				</tr>
			</thead>
			<tbody>
				<tr>
					<td>
						OITAVA REVISAO
					</td>
					<td>
						<input class="input" type="radio" />
					</td>
					<td>
						80000
					</td>
					<td>
						96 meses
					</td>
					<td>
						NOVOS
					</td>
					<td>
						<a href="javascript:void(0)">Um link aqui</a>
					</td>
				</tr>
				<tr>
					<td>
						MONTANA 12M GARANTIA ESPECIAL
					</td>
					<td>
						<input class="input" type="radio" />
					</td>
					<td>
						
					</td>
					<td>
						12 meses
					</td>
					<td>
						NOVOS
					</td>
					<td>
						<a href="javascript:void(0)">Um link aqui</a>
					</td>
				</tr>
				<tr>
					<td>
						to - 10.000KM - PASSANTES
					</td>
					<td>
						<select class="input" style="height: 20px;" disabled="disabled">
							<option value="teste">TESTE TEXTO QUALQUER</option>
						</select>
					</td>
					<td>
						10000
					</td>
					<td>
						12 meses
					</td>
					<td>
						USADOS
					</td>
					<td>
						<a href="javascript:void(0)">Um link aqui</a>
					</td>
				</tr>
				<tr>
					<td>
						TO - 105.000KM - PASSANTES
					</td>
					<td>
						<input class="input" type="text" disabled="disabled" />
					</td>
					<td>
						95000
					</td>
					<td>
						<input class="input" type="radio" />
					</td>
					<td>
						USADOS
					</td>
					<td>
						<a href="javascript:void(0)">Um link aqui</a>
					</td>
				</tr>
			</tbody>
			<thead>
				<tr>
					<td>Revisões da Empresa Y</td>
					<td>Coluna do input</td>
					<td>KM</td>
					<td>Tempo</td>
					<td>Critério</td>
					<td>Links</td>
				</tr>
			</thead>
			<tbody>
				<tr>
					<td>
						TO - 5.000KM - PASSANTES
					</td>
					<td>
						<input class="input" type="checkbox" />
					</td>
					<td>
						5000
					</td>
					<td>
						6 meses
					</td>
					<td>
						USADOS
					</td>
					<td>
						<a href="javascript:void(0)">Um link aqui</a>
					</td>
				</tr>
			</tbody>
			<tfoot>
				<tr>
					<td>Footer col 0</td>
					<td>Footer col 1</td>
					<td>Footer col 2</td>
					<td>Footer col 3</td>
					<td>Footer col 4</td>
					<td>Footer col 5</td>
				</tr>
			</tfoot>
		</table>
		<hr />
		Table 4:
		<table id="t4">
			<thead>
				<tr>
					<th>Nome</th>
					<th>Endereço</th>
				</tr>
			</thead>
			<tbody>
				<tr>
					<td>Alfredo Martins da Silva</td>
					<td>Rua Jacinto Kubitz</td>
				</tr>
				<tr style="display: none;">
					<td colspan="2">
						Essa linha JAMAIS DEVE APARECER TAMBÉM
					</td>
				</tr>
				<tr>
					<td>Manuel Marca dos Santos</td>
					<td>Avenida Muamba</td>
				</tr>
				<tr>
					<td>Fernando da Silva Martins</td>
					<td>Rua Dr. Garibaldo Cristini Fonseca Perna Grossa Perna Seca</td>
				</tr>
				<tr style="display: none;">
					<td colspan="2">
						Essa linha JAMAIS DEVE APARECER
					</td>
				</tr>
			</tbody>
		</table>
		<hr />
		Table 5:
		<table id="t5">
			<thead>
				<tr>
					<th>Nome</th>
					<th>Endereço</th>
				</tr>
			</thead>
			<tbody>
				<tr>
					<td>Alfredo Martins da Silva</td>
					<td>Rua Jacinto Kubitz</td>
				</tr>
				<tr style="display: none;">
					<td colspan="2">
						Essa linha JAMAIS DEVE APARECER TAMBÉM
					</td>
				</tr>
				<tr>
					<td>Manuel Marca dos Santos</td>
					<td>Avenida Muamba</td>
				</tr>
				<tr>
					<td>Fernando da Silva Martins</td>
					<td>Rua Dr. Garibaldo Cristini Fonseca Perna Grossa Perna Seca</td>
				</tr>
				<tr style="display: none;">
					<td colspan="2">
						Essa linha JAMAIS DEVE APARECER
					</td>
				</tr>
			</tbody>
		</table>
	</body>
</html>